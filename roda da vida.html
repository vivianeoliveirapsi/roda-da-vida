<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Roda da Vida — Dinâmico</title>
  <style>
    :root{
      --bg:#faf9f6; --card:#ffffff; --text:#1f2937; --muted:#6b7280; --accent:#16a34a;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#f7faf6 0%,var(--bg) 100%);color:var(--text);}
    .wrap{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between}
    h1{font-size:20px;margin:0}
    .grid{display:grid;grid-template-columns:420px 1fr;gap:18px;margin-top:18px}
    .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(16,24,40,0.06)}
    canvas{width:100%;height:auto;display:block}
    .controls{height:650px;overflow:auto;padding-right:6px}
    .area-row{display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid rgba(15,23,42,0.03)}
    .badge{width:14px;height:14px;border-radius:4px;flex:0 0 14px}
    .label{flex:0 0 170px;font-weight:600}
    .slider{flex:1}
    input[type=range]{width:100%}
    .percent{width:46px;text-align:right;font-weight:700}
    .results{margin-top:12px}
    .res-row{display:flex;align-items:center;justify-content:space-between;padding:6px 0}
    .btns{display:flex;gap:8px;flex-wrap:wrap}
    button{background:var(--accent);color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
    button.secondary{background:#0ea5a4}
    .small{font-size:13px;padding:6px 10px}
    footer{margin-top:14px;color:var(--muted);font-size:13px}
    @media(max-width:980px){.grid{grid-template-columns:1fr;}.controls{height:auto}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Roda da Vida — Dinâmica</h1>
        <div style="color:var(--muted);font-size:13px;margin-top:6px">Ajuste cada área (0–100).</div>
      </div>
      <div class="btns">
        <button id="downloadPng" class="small">Download PNG</button>
      </div>
    </header>

    <div class="grid">
      <div class="card controls">
        <!-- Controles (sliders) -->
        <div id="areasList"></div>
      </div>

      <div class="card">
        <canvas id="wheel" width="760" height="760" aria-label="Roda da vida (gráfico)"></canvas>
        <div style="display:flex;gap:12px;margin-top:12px;align-items:center;flex-wrap:wrap">
          <div style="color:var(--muted);font-size:13px">Legenda: cada área com sua cor — mova os controles à esquerda.</div>
          <div style="margin-left:auto;color:var(--muted);font-size:13px">Baixe como imagem</div>
        </div>

        <!-- Resultado por Área movido para cá -->
        <div class="results card" style="margin-top:20px">
          <h3 style="margin:0 0 8px 0;font-size:15px">Resultado por Área</h3>
          <div id="resultList"></div>
        </div>
      </div>
    </div>

    <footer>© 2025 Viviane Oliveira | CRP 11/22526. Todos os direitos reservados.</footer>
  </div>

  <script>
    const AREAS = [
      {key:'FAMÍLIA', color:'#16a34a'},
      {key:'RELAÇÃO AMOROSA', color:'#db2777'},
      {key:'VIDA SOCIAL', color:'#f59e0b'},
      {key:'ESPIRITUALIDADE', color:'#7c3aed'},
      {key:'Hobbies e Diversão', color:'#06b6d4'},
      {key:'Plenitude e Felicidade', color:'#ef4444'},
      {key:'Contribuição Social', color:'#0ea5a4'},
      {key:'Recursos Financeiros', color:'#f97316'},
      {key:'Realização e Propósito', color:'#6366f1'},
      {key:'Saúde e Disposição', color:'#10b981'},
      {key:'Equilíbrio Emocional', color:'#ec4899'},
      {key:'Desenvolvimento Intelectual', color:'#84cc16'}
    ];

    const values = AREAS.map(()=>60);

    const areasList = document.getElementById('areasList');
    const resultList = document.getElementById('resultList');
    const canvas = document.getElementById('wheel');
    const ctx = canvas.getContext('2d');
    const downloadPng = document.getElementById('downloadPng');

    function buildControls(){
      areasList.innerHTML = '';
      AREAS.forEach((a,i)=>{
        const row = document.createElement('div'); row.className='area-row';
        const badge = document.createElement('div'); badge.className='badge'; badge.style.background=a.color;
        const label = document.createElement('div'); label.className='label'; label.textContent=a.key;
        const sliderWrap = document.createElement('div'); sliderWrap.className='slider';
        const input = document.createElement('input'); input.type='range'; input.min=0; input.max=100; input.value=values[i]; input.dataset.index=i;
        input.addEventListener('input',onChange);
        sliderWrap.appendChild(input);
        const percent = document.createElement('div'); percent.className='percent'; percent.textContent = values[i] + '%';
        row.appendChild(badge); row.appendChild(label); row.appendChild(sliderWrap); row.appendChild(percent);
        areasList.appendChild(row);
      });
    }

    function onChange(e){
      const i = +e.target.dataset.index;
      values[i] = +e.target.value;
      e.target.parentElement.nextSibling.textContent = values[i] + '%';
      draw(); updateResults();
    }

    function draw(){
      const W = canvas.width; const H = canvas.height;
      ctx.clearRect(0,0,W,H);
      const cx = W/2, cy = H/2;
      const radius = Math.min(W,H)/2 - 60;
      const steps = 5;

      ctx.save();
      ctx.translate(cx,cy);
      ctx.strokeStyle = 'rgba(15,23,42,0.06)'; ctx.lineWidth=1;
      for(let s=1;s<=steps;s++){
        ctx.beginPath(); ctx.arc(0,0,(radius/steps)*s,0,Math.PI*2); ctx.stroke();
      }
      for(let i=0;i<AREAS.length;i++){
        const ang = (i/AREAS.length)*Math.PI*2 - Math.PI/2;
        ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(Math.cos(ang)*radius,Math.sin(ang)*radius); ctx.stroke();
      }

      const points = [];
      for(let i=0;i<AREAS.length;i++){
        const pct = values[i]/100;
        const ang = (i/AREAS.length)*Math.PI*2 - Math.PI/2;
        const r = pct*radius;
        const x = Math.cos(ang)*r, y = Math.sin(ang)*r;
        points.push({x,y});
      }
      const avgColor = averageColor(AREAS.map(a=>a.color));
      ctx.beginPath();
      points.forEach((p,idx)=>{ if(idx===0) ctx.moveTo(p.x,p.y); else ctx.lineTo(p.x,p.y); });
      ctx.closePath();
      ctx.globalAlpha = 0.25; ctx.fillStyle = avgColor; ctx.fill(); ctx.globalAlpha = 1;

      for(let i=0;i<AREAS.length;i++){
        const a = AREAS[i];
        const p = points[i];
        ctx.beginPath(); ctx.strokeStyle = hexToRgba(a.color,0.9); ctx.lineWidth=2;
        ctx.moveTo(0,0); ctx.lineTo(p.x,p.y); ctx.stroke();
        ctx.beginPath(); ctx.fillStyle = a.color; ctx.arc(p.x,p.y,6,0,Math.PI*2); ctx.fill();

        // Desenhar o percentual ao lado do ponto
        ctx.font = '12px Inter, system-ui, -apple-system';
        ctx.fillStyle = '#111827';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'bottom';
        ctx.fillText(values[i] + '%', p.x, p.y - 8);
      }

      ctx.beginPath(); points.forEach((p,idx)=>{ if(idx===0) ctx.moveTo(p.x,p.y); else ctx.lineTo(p.x,p.y); }); ctx.closePath();
      ctx.lineWidth=2; ctx.strokeStyle = 'rgba(15,23,42,0.12)'; ctx.stroke();

      ctx.font = '14px Inter, system-ui, -apple-system'; ctx.fillStyle = '#0f172a'; ctx.textAlign='center'; ctx.textBaseline='middle';
      for(let i=0;i<AREAS.length;i++){
        const ang = (i/AREAS.length)*Math.PI*2 - Math.PI/2;
        const lx = Math.cos(ang)*(radius+28);
        const ly = Math.sin(ang)*(radius+28);
        wrapText(ctx,AREAS[i].key,lx,ly,120,14);
      }
      ctx.restore();
    }

    function updateResults(){
      resultList.innerHTML='';
      AREAS.forEach((a,i)=>{
        const row = document.createElement('div'); row.className='res-row';
        const left = document.createElement('div'); left.style.display='flex'; left.style.alignItems='center'; left.style.gap='8px';
        const badge = document.createElement('div'); badge.className='badge'; badge.style.background=a.color;
        const label = document.createElement('div'); label.textContent = a.key; label.style.fontWeight=700; label.style.fontSize='13px';
        left.appendChild(badge); left.appendChild(label);
        const right = document.createElement('div'); right.style.minWidth='120px';
        const barWrap = document.createElement('div'); barWrap.style.background='#eee'; barWrap.style.borderRadius='10px'; barWrap.style.overflow='hidden'; barWrap.style.height='10px';
        const bar = document.createElement('div'); bar.style.width = values[i]+'%'; bar.style.height='100%'; bar.style.background = a.color; barWrap.appendChild(bar);
        const pct = document.createElement('div'); pct.textContent = ' '+values[i]+'%'; pct.style.display='inline-block'; pct.style.marginLeft='8px'; pct.style.fontWeight=700;
        right.appendChild(barWrap); right.appendChild(pct);
        row.appendChild(left); row.appendChild(right);
        resultList.appendChild(row);
      });
    }

    function wrapText(ctx,text,x,y,maxWidth,lineHeight){
      const words = text.split(' ');
      let line = '', lines = [], test;
      for(let n=0;n<words.length;n++){
        test = line + words[n] + ' ';
        if(ctx.measureText(test).width > maxWidth && n>0){ lines.push(line.trim()); line = words[n]+' '; } else line = test;
      }
      if(line) lines.push(line.trim());
      const totalH = lines.length*lineHeight;
      for(let i=0;i<lines.length;i++) ctx.fillText(lines[i], x, y - totalH/2 + i*lineHeight + lineHeight/2);
    }

    function hexToRgba(hex,alpha=1){
      const h = hex.replace('#',''); const bigint = parseInt(h,16);
      const r = (bigint >> 16) & 255; const g = (bigint >> 8) & 255; const b = bigint & 255;
      return `rgba(${r},${g},${b},${alpha})`;
    }

    function averageColor(hexArray){
      let r=0,g=0,b=0;
      hexArray.forEach(h=>{ const c=parseInt(h.replace('#',''),16); r+= (c>>16)&255; g+= (c>>8)&255; b+= c&255; });
      r=Math.round(r/hexArray.length); g=Math.round(g/hexArray.length); b=Math.round(b/hexArray.length);
      return `rgba(${r},${g},${b},0.15)`;
    }

    downloadPng.addEventListener('click',()=>{
      const scale = 2; const off = document.createElement('canvas'); off.width = canvas.width*scale; off.height = canvas.height*scale; const octx = off.getContext('2d');
      octx.fillStyle = '#ffffff'; octx.fillRect(0,0,off.width,off.height);
      octx.drawImage(canvas,0,0,off.width,off.height);
      const a = document.createElement('a'); a.href = off.toDataURL('image/png'); a.download = 'roda-da-vida.png'; a.click();
    });

    buildControls(); draw(); updateResults();
  </script>
</body>
</html>
